<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * App entry root module
 * @module app
 */

/* eslint-disable max-lines-per-function */
import dotenv from "dotenv";
import express from "express";
import statusCode from "http-status-codes";
import rateLimit from "express-rate-limit";
import winston from "winston";
import api from "./api";
import db from "./db";
import {
  centralErrorHandler
} from "./errors";

/**
 * This is our api server program entry function
 */
// eslint-disable-next-line max-statements
const main = () => {

  /** Loads environment variables from .env file if exists */
  dotenv.config();

  const logger = winston.createLogger({
    // eslint-disable-next-line no-ternary
    "level": process.env.NODE_ENV === "production"
      ? "info"
      : "debug",
    // Uses json format for log messages
    "format": winston.format.json(),
    // Prints log messages to standard console
    "transports": [new winston.transports.Console()]
  });

  // PORT env is used to define api server listening port
  const PORT = process.env.PORT || "3000";
  const app = express();

  // Adds db connection to express app context
  app.set("db", db);

  // Uses '/api' sub router
  app.use("/api", api);

  /**
   * This middleware apply rate limitings to express and can help
   * on DOS/DDOS attacks.
   */
  // eslint-disable-next-line no-magic-numbers
  const FifteenMinutes = 15 * 60 * 1000;
  const RequestsPerWindowMS = 100;
  const limiter = rateLimit({
    "windowMs": FifteenMinutes,
    "max": RequestsPerWindowMS,
    "message":
      "Too many accounts created from this IP, please try again after an hour"
  });

  app.use(limiter);

  /**
   * This custom middleware will capture all non-valid requests
   * and then return a custom 404 error message to client
   */
  app.use((req, res, next) => {
    res.
      status(statusCode.NOT_FOUND).
      type("text").
      send("the resource you are looking for does not exist");
    next(req, res);
  });

  /**
   * This custom middleware will capture all errors and exceptions
   * and then return a custom 500 error message to client
   */
  // eslint-disable-next-line max-params
  app.use((err, req, res, next) => {
    if (err.code === statusCode.NOT_FOUND) {
      res.
        status(statusCode.NOT_FOUND).
        type("text").
        send(err.message);
    } else if (err.code === statusCode.INTERNAL_SERVER_ERROR) {
      res.
        status(statusCode.INTERNAL_SERVER_ERROR).
        type("text").
        send(err.message);
    }

    logger.error(err.message);
    centralErrorHandler(err);
    next(req, res);
  });

  // This will start our server and binds it to our ${PORT} number
  app.listen(PORT, () => {
    logger.info(`api server is running and listening on port ${PORT}`);
  });
};

main();

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-app.html">app</a></li><li><a href="module-app_api.html">app/api</a></li><li><a href="module-app_api_v1.html">app/api/v1</a></li><li><a href="module-app_api_v1_humans.html">app/api/v1/humans</a></li><li><a href="module-app_api_v1_humans-business.html">app/api/v1/humans-business</a></li><li><a href="module-app_api_v1_humans-data-access.html">app/api/v1/humans-data-access</a></li><li><a href="module-errors.html">errors</a></li><li><a href="module-Validations.html">Validations</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Apr 03 2019 21:54:40 GMT+0430 (Iran Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
